{% extends "layout/install.html" %}


{% block body %}

<div class="card-panel blue-grey grey lighten-3">

<header>
        <center><h1>{{_("onyx.installation")}}</h1></center>
</header>

<div class="col s12">
    <ul class="tabs blue darken-4">
        <li class="step1 tab col m4 s12"><a href="#step1" class="active">{{_("onyx.install.welcome")}}</a>
        </li>
        <li class="step2 tab col m4 s12 disabled"><a href="#step2">{{_("onyx.install.data_download")}}</a>
        </li>
        <li class="step3 tab col m4 s12 disabled"><a href="#step3">{{_("onyx.install.create_admin_account")}}</a>
        </li>
        <li class="step3 tab col m4 s12 disabled"><a href="#step4">{{_("House")}}</a>
        </li>
        <li class="step4 tab col m4 s12 disabled"><a href="#step5">{{_("onyx.install.final")}}</a>
        </li>
    </ul>
</div>


<div class="card-panel white" id="step1">
    <div class="col-md-8 col-md-offset-2">
        <div class="well well-sm">
                <p>{{_("onyx.install.welcome_to_onyx")}}</p>

                <form method="POST" action="{{url_for('install.change_lang')}}">
                    <p>{{_("onyx.install.choice_lang")}}</p>
                    <select id="lang" name="lang" class="browser-default">
						<option value="fr-FR">{{_("onyx.install.french")}}</option>
						<option value="en-US">{{_("onyx.install.english")}}</option>
					</select><br>
                    <button class="btn blue darken-4 btn-lg" name="button">{{_("onyx.change_lang")}}</button>
				</form>
				
                <br>
                <button id="etape1" class="btn blue darken-4 btn-lg">{{_("onyx.install.next")}}</button>
        </div>
    </div>
</div>


<div class="card-panel white" id="step2">
    <div class="col-md-8 col-md-offset-2">
        <div class="well well-sm">
                <h3 class="text-center">{{_("onyx.install.data_download")}}</h3><br><br>

                <center>
                    <p class="dl_text">{{_("Downloaded")}} !</p>
                </center>
                <div class="progress">
                    <div class="indeterminate"></div>
                </div>

                <button id="data" class="btn blue darken-4 btn-lg">{{_("Download")}}</button><br><br>


                <button id="etape2" class="btn blue darken-4 btn-lg">{{_("onyx.install.next")}}</button>
        </div>
    </div>
</div>

<form class="register-form" method=post action="">

<div class="card-panel white" id="step3">
    <div class="col-md-8 col-md-offset-2">
        <div class="well well-sm">
                <h3 class="text-center">{{_("onyx.install.create_admin_account")}}</h3>

                    <input type="text" id="username" name="username" placeholder='{{_("Username")}}' value="{{ request.form.username }}" required>

                    <input type="password" id="password" name="password" placeholder='{{_("Password")}}' value="{{ request.form.password }}" required>

                    <input type="email" id="email" name="email" class="input-xlarge" placeholder='{{_("Email")}}' value="{{ request.form.email }}" required>


                    <div class="form-group">
                        <div class="col-md-12 text-right">
                            <span id="etape3" class="btn blue darken-4 btn-lg">{{_("onyx.install.next")}}</span>
                        </div>
                    </div>

        </div>
    </div>
</div>

<div class="card-panel white" id="step4">
    <div class="col-md-8 col-md-offset-2">
        <div class="well well-sm">
            <h3 class="text-center">{{_("Configure your House")}}</h3>

            <input type="text" id="name" name="name" placeholder='{{_("Name")}}' value="{{ request.form.name }}" required>

            <input type="text" id="address" name="address" placeholder='{{_("Address")}}' value="{{ request.form.address }}" required>
            
            <input type="text" id="city" name="city" placeholder='{{_("City")}}' value="{{ request.form.city }}" required>

            <input type="text" id="postal" name="postal" placeholder='{{_("Postal")}}' value="{{ request.form.postal }}" required>

            <input type="text" id="country" name="country" placeholder='{{_("Country")}}' value="{{ request.form.country }}" required>

            <input type="text" id="latitude" name="latitude" placeholder='{{_("Latitude")}}' value="{{ request.form.latitude }}" required>

            <input type="text" id="longitude" name="longitude" placeholder='{{_("Longitude")}}' value="{{ request.form.longitude }}" required><br>

            <button onClick="getLocation();" class="btn blue darken-4 btn-lg">{{_("Get Current Position")}}</button>


            <h3 class="text-center">{{_("Weather")}}</h3>

            <p>{{_("We need your DarkSky API key to access to the weather : ")}} <a href="https://darksky.net/dev">DarkSky</a> </p><br>

            <input type="text" id="weather_api" name="weather_api" placeholder='{{_("API Token")}}' value="{{ request.form.weather_api }}" required>
    
            <div class="form-group">
                <div class="col-md-12 text-right">
                    <span id="etape4" class="btn blue darken-4 btn-lg">{{_("onyx.install.next")}}</span>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="card-panel white" id="step5">
    <div class="col-md-8 col-md-offset-2">
        <div class="well well-sm">
                <h3 class="text-center">{{_("Final")}}</h3>

                <p>{{_("Your assistant is now correctly set! You can still change all these settings from your admin panel!")}}</p>
                <p>{{_("You can now connect to the control panel, and add it to your favorites.")}}</p>
                <div>{{_("Share the project !")}}</div><br>

                <div class="form-group">
                    <div class="col-md-12 text-right">
                        <button class="btn blue darken-4 btn-lg">{{_("Access to Onyx")}}</button>
                    </div>
                </div>
        </div>
    </div>
</div>

</form>

<footer>
        <p>Â© Onyx 2019 - {{_("onyx.install.if_problem")}} : <a href="https://onyxlabs.fr/forum/">https://onyxlabs.fr</a></p>
</footer>

</div>


{% endblock %}

{% block script %}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.8/js/materialize.min.js"></script>

<script type="text/javascript">

    $(document).ready(function() {
        $('#etape2').hide();
        $('.progress').hide();
		$('.dl_text').hide();
		
		$('ul.tabs').tabs();
		
        $("#etape1").click(function() {
            $('.step2').removeClass('disabled');
            $('ul.tabs').tabs('select_tab', 'step2');
		});
		
        $("#etape2").click(function() {
            $('.step3').removeClass('disabled');
            $('ul.tabs').tabs('select_tab', 'step3');
		});
		
        $("#etape3").click(function() {
            var username = document.getElementById('username').value;
            var password = document.getElementById('password').value;
			var email = document.getElementById('email').value;
			
            if (username == "" || password == "" || email == "") {
                alert('{{_("onyx.install.field_required")}}');
                return false;
			}
			
            if (/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(email))
            {
				$('.step4').removeClass('disabled');
				$('ul.tabs').tabs('select_tab', 'step4');
            }else{
				alert('{{_("onyx.install.invalid_email")}}');
				return false;
            }
        });

        $("#etape4").click(function() {
            $('.step5').removeClass('disabled');
            $('ul.tabs').tabs('select_tab', 'step5');
		});

        $("#data").click(function() {
            $('#data').hide();
			$('.progress').show();
			
            $.ajax({
                url: '{{ url_for("install.data") }}',
                type: "GET",
                success: function(rep) {
                    $('.progress').hide();
                    $('.dl_text').show();
                    $('#etape2').show();
                }
            });
        });
    });
</script>

<script>
		var lon = document.getElementById("longitude");
		var lat = document.getElementById("latitude");
		function getLocation() {
			if (navigator.geolocation) {
				navigator.geolocation.getCurrentPosition(showPosition);
			} else {
				alert("Geolocation is not supported by this browser.");
			}
		}
		
		function showPosition(position) {
			lon.value = position.coords.longitude;
			lat.value = position.coords.latitude
		}

</script> 

{% endblock %}
